from shape_callbacks import shape_analysis
from shape_gui import ShapeApp
import json

tokamak = 'mastu'
rb = [0.5549, 0.5796, 0.6041, 0.6284, 0.6527, 0.6769, 0.7011, 0.7253, 0.7493, 0.7732, 0.7969, 0.8205, 0.8438, 0.8669, 0.8898, 0.9122, 0.9343, 0.9559, 0.9771, 0.9978, 1.0181, 1.0379, 1.0571, 1.0759, 1.0942, 1.1119, 1.1291, 1.1457, 1.1617, 1.1770, 1.1917, 1.2056, 1.2187, 1.2311, 1.2426, 1.2534, 1.2635, 1.2728, 1.2815, 1.2897, 1.2974, 1.3048, 1.3119, 1.3189, 1.3256, 1.3323, 1.3391, 1.3456, 1.3522, 1.3587, 1.3648, 1.3707, 1.3762, 1.3810, 1.3851, 1.3883, 1.3905, 1.3917, 1.3917, 1.3905, 1.3883, 1.3851, 1.3810, 1.3761, 1.3707, 1.3647, 1.3586, 1.3521, 1.3455, 1.3389, 1.3322, 1.3254, 1.3186, 1.3117, 1.3045, 1.2972, 1.2896, 1.2815, 1.2728, 1.2636, 1.2537, 1.2431, 1.2317, 1.2195, 1.2066, 1.1928, 1.1783, 1.1632, 1.1473, 1.1308, 1.1137, 1.0961, 1.0779, 1.0592, 1.0399, 1.0202, 1.0000, 0.9793, 0.9580, 0.9364, 0.9143, 0.8919, 0.8691, 0.8459, 0.8225, 0.7989, 0.7750, 0.7510, 0.7269, 0.7025, 0.6781, 0.6534, 0.6285, 0.6032, 0.5777, 0.5564, 0.5422, 0.5312, 0.5213, 0.5119, 0.5028, 0.4939, 0.4849, 0.4760, 0.4672, 0.4583, 0.4494, 0.4407, 0.4320, 0.4235, 0.4151, 0.4068, 0.3988, 0.3910, 0.3834, 0.3761, 0.3691, 0.3624, 0.3560, 0.3499, 0.3441, 0.3387, 0.3336, 0.3289, 0.3244, 0.3203, 0.3166, 0.3132, 0.3101, 0.3074, 0.3050, 0.3029, 0.3012, 0.2998, 0.2987, 0.2979, 0.2975, 0.2973, 0.2975, 0.2981, 0.2989, 0.3001, 0.3016, 0.3035, 0.3056, 0.3081, 0.3110, 0.3141, 0.3176, 0.3215, 0.3257, 0.3302, 0.3351, 0.3402, 0.3457, 0.3516, 0.3578, 0.3643, 0.3711, 0.3781, 0.3855, 0.3931, 0.4009, 0.4090, 0.4172, 0.4256, 0.4341, 0.4427, 0.4514, 0.4601, 0.4688, 0.4774, 0.4861, 0.4946, 0.5030, 0.5114, 0.5197, 0.5279, 0.5360, 0.5444, ]
zb = [-1.0754, -1.0710, -1.0631, -1.0549, -1.0466, -1.0382, -1.0297, -1.0209, -1.0119, -1.0026, -0.9928, -0.9826, -0.9719, -0.9608, -0.9490, -0.9366, -0.9235, -0.9097, -0.8952, -0.8801, -0.8644, -0.8480, -0.8310, -0.8135, -0.7955, -0.7770, -0.7579, -0.7383, -0.7183, -0.6977, -0.6766, -0.6550, -0.6330, -0.6105, -0.5876, -0.5643, -0.5407, -0.5168, -0.4926, -0.4683, -0.4438, -0.4193, -0.3946, -0.3699, -0.3451, -0.3204, -0.2956, -0.2708, -0.2460, -0.2211, -0.1962, -0.1712, -0.1462, -0.1210, -0.0956, -0.0702, -0.0446, -0.0190, 0.0067, 0.0323, 0.0579, 0.0834, 0.1087, 0.1339, 0.1590, 0.1839, 0.2089, 0.2337, 0.2585, 0.2833, 0.3081, 0.3328, 0.3576, 0.3823, 0.4069, 0.4315, 0.4560, 0.4804, 0.5046, 0.5285, 0.5522, 0.5755, 0.5985, 0.6211, 0.6433, 0.6650, 0.6861, 0.7068, 0.7270, 0.7467, 0.7658, 0.7845, 0.8026, 0.8201, 0.8371, 0.8535, 0.8693, 0.8844, 0.8989, 0.9127, 0.9258, 0.9382, 0.9500, 0.9610, 0.9715, 0.9815, 0.9911, 1.0002, 1.0088, 1.0170, 1.0247, 1.0318, 1.0379, 1.0420, 1.0405, 1.0269, 1.0055, 0.9824, 0.9587, 0.9348, 0.9108, 0.8868, 0.8627, 0.8386, 0.8145, 0.7905, 0.7664, 0.7422, 0.7181, 0.6939, 0.6696, 0.6453, 0.6210, 0.5965, 0.5720, 0.5474, 0.5227, 0.4979, 0.4731, 0.4481, 0.4231, 0.3980, 0.3729, 0.3477, 0.3224, 0.2971, 0.2717, 0.2462, 0.2207, 0.1952, 0.1697, 0.1441, 0.1185, 0.0929, 0.0672, 0.0416, 0.0159, -0.0098, -0.0354, -0.0611, -0.0867, -0.1124, -0.1380, -0.1636, -0.1892, -0.2147, -0.2402, -0.2657, -0.2911, -0.3165, -0.3418, -0.3671, -0.3923, -0.4174, -0.4425, -0.4675, -0.4924, -0.5172, -0.5419, -0.5666, -0.5912, -0.6157, -0.6402, -0.6645, -0.6888, -0.7131, -0.7373, -0.7615, -0.7856, -0.8098, -0.8339, -0.8581, -0.8823, -0.9065, -0.9307, -0.9550, -0.9792, -1.0036, -1.0279, -1.0522, ]


app = ShapeApp(tokamak)
s = shape_analysis(rb, zb)
s['Rout'] = s['ro']
s['Rin'] = s['ri']
s['Zlo'] = s['zl']
s['Zup'] = s['zu']
s = app.add_aux_geom_params(s)
segs = app.get_segs()
rcp, zcp = app.seg_intersections(segs, rb, zb)
s['rcp'] = rcp.tolist()
s['zcp'] = zcp.tolist()
s['rb'] = rb
s['zb'] = zb
s['segs'] = segs.tolist()
s['rl'] = app.rl
s['zl'] = app.zl
seg_params = app.tkdict2dict(app.seg_params)


d = {'shape_params':s, 'seg_params':seg_params}
# app.save_file(d)      
# print('Shape saved to file successfully.')  

with open('./test.json', 'w') as f:
    f.write(json.dumps(d, indent=4))
